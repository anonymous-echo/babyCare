# Nutri-Baby 功能需求分析说明书

## 1. 引言
本文档基于 BabyCare 项目现有架构，旨在打造 "记录 - 分析 - 指导 - 共享" 一体化育儿工具。重点解决云托管存储痛点，并扩展 P0-P3 阶段核心功能。

## 2. 核心架构与约束
- **技术栈**: Union-App (Vue3+TS), Go (DDD), PostgreSQL, Redis.
- **云平台**: 微信云托管 (Container + COS).
- **多端支持**: 优先微信小程序，兼容 H5.
- **体验指标**: 启动<3s, 单手操作, 夜间模式.

## 3. 功能模块详细分析

### 3.1 核心记录优化 (P0)

#### 3.1.1 喂养管理
- **需求描述**: 这是一个高频场景。用户需要快速记录母乳（区分左右）、奶粉或辅食。
- **功能点**:
    - **母乳**: 记录开始/结束时间，计算时长。**新增**: 左右乳房切换标记（L/R），自动计算单侧时长。
    - **奶粉/辅食**: 记录容量/重量，种类。**新增**: 智能推荐量（基于月龄/体重，需后端计算）。
    - **过敏档案**: 记录过敏食物，下次记录该食物时触发警告。
- **数据结构变动**: `feeding_records` 表需增加 `breast_side` (enum), `food_type`, `allergy_warning` 字段。

#### 3.1.2 睡眠监测
- **需求描述**: 追踪宝宝睡眠质量，提供改善建议。
- **功能点**:
    - **周期追踪**: 记录入睡/醒来时间。**新增**: 标记睡眠状态（安睡/闹觉），虽然无法通过手机直接测脑波，但可通过用户标记或声音监测辅助推断。
    - **白噪音**: 前端本地/流媒体播放白噪音（雨声、海浪等），支持定时关闭。
    - **分析**: 统计日/周睡眠总时长，对比同月龄标准。

#### 3.1.3 成长管理
- **需求描述**: 关注身体发育指标。
- **功能点**:
    - **多维记录**: 身高、体重、头围。
    - **WHO 曲线**: 前端渲染标准曲线（SD 线），将宝宝数据描点对比。
    - **里程碑**: 根据月龄推送（如3个月抬头，6个月独坐），用户打卡。

### 3.2 智能 AI 增强 (P1)

#### 3.2.1 哭声分析
- **需求描述**: 解决新手父母"不懂宝宝为什么哭"的焦虑。
- **功能点**:
    - **录音上传**: 前端录制 5-10s 音频。
    - **AI 识别**: 后端对接音频分类模型（或云API），返回概率（饥饿 80%, 困倦 10%）。
    - **反馈训练**: 用户确认真实原因，回传用于优化模型。

#### 3.2.2 健康预警 (P2)
- **功能点**:
    - **症状自查**: 问卷式交互（发热->多少度->精神状态），给出建议（非医疗诊断）。
    - **体温记录**: 结合图表展示体温变化趋势。

### 3.3 实用工具与社区 (P3)

#### 3.3.1 智能日程
- **功能点**: 基于月龄生成推荐作息表（E.A.S.Y 模式等）。支持家庭共享。

#### 3.3.2 亲子互动 & 社区
- **功能点**: 分龄游戏推荐。同城圈子。

## 4. 技术优化：云存储适配 (P0)

### 4.1 现状与问题
- 当前使用 HTTP 上传，或简单 PUT。大文件（视频）易失败，不支持断点续传。
- 内网域名无法被小程序访问。

### 4.2 优化方案
- **分片上传**: 前端使用 COS SDK (Web版/小程序版)，在前端进行分片。
- **签名直传**: 后端只负责生成临时密钥 (STS) 或预签名 URL，不中转文件流，减轻服务器压力，大幅提升速度。
- **图片压缩**: `uni.compressImage` 在上传前压缩图片，减少流量和耗时。
- **CDN 加速**: 确保 COS 开启 CDN，配置小程序合法域名。

## 5. 开发计划 (Roadmap)

1.  **Phase 1 (Now)**: 建立 `docs`，完成 COS 签名直传改造 (Backend STS + Frontend SDK)，实现 P0 喂养/生长记录的字段扩展与 UI 更新。
2.  **Phase 2**: 引入 Echarts 实现生长曲线，开发白噪音组件。
3.  **Phase 3**: 接入 AI 哭声识别 Demo，完善家庭权限系统。
